@page "/szobak/kategoriak"
@inject ISzobaRepository SzobaRepo
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>
    Szobakategóriák
</PageTitle>

<a class="btn btn-primary mb-3" href="/szobak/kategoriak/uj">
    <svg class="icon-outline" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" viewBox="0 0 24 24">
        <path d="M 12 2 C 6.4889971 2 2 6.4889971 2 12 C 2 17.511003 6.4889971 22 12 22 C 17.511003 22 22 17.511003 22 12 C 22 6.4889971 17.511003 2 12 2 z M 12 4 C 16.430123 4 20 7.5698774 20 12 C 20 16.430123 16.430123 20 12 20 C 7.5698774 20 4 16.430123 4 12 C 4 7.5698774 7.5698774 4 12 4 z M 11 7 L 11 11 L 7 11 L 7 13 L 11 13 L 11 17 L 13 17 L 13 13 L 17 13 L 17 11 L 13 11 L 13 7 L 11 7 z"></path>
    </svg>
    Új kategória
</a>
<a class="btn btn-secondary mb-3" href="/szobak">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5" />
    </svg>
    Vissza a szobákhoz
</a>

@if (Kategoriak is null || Kategoriak.Count == 0)
{
    <div class="kat-item">Nincsenek kategóriák.</div>
}
else
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Megnevezés</th>
                <th scope="col">Egységár (HUF/fő/éjszaka)</th>
                <th scope="col">Műveletek</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var kat in Kategoriak)
            {
                <tr>
                    <th scope="row">@kat.Id</th>
                    <td>@kat.Megnevezes</td>
                    <td>@kat.EgysegAr</td>
                    <td>
                        <a href="@($"/szobak/kategoriak/modosit/{kat.Id}")" class="btn btn-secondary">
                            <svg class="icon-outline" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" viewBox="0 0 50 50">
                                <path d="M 43.125 2 C 41.878906 2 40.636719 2.488281 39.6875 3.4375 L 38.875 4.25 L 45.75 11.125 C 45.746094 11.128906 46.5625 10.3125 46.5625 10.3125 C 48.464844 8.410156 48.460938 5.335938 46.5625 3.4375 C 45.609375 2.488281 44.371094 2 43.125 2 Z M 37.34375 6.03125 C 37.117188 6.0625 36.90625 6.175781 36.75 6.34375 L 4.3125 38.8125 C 4.183594 38.929688 4.085938 39.082031 4.03125 39.25 L 2.03125 46.75 C 1.941406 47.09375 2.042969 47.457031 2.292969 47.707031 C 2.542969 47.957031 2.90625 48.058594 3.25 47.96875 L 10.75 45.96875 C 10.917969 45.914063 11.070313 45.816406 11.1875 45.6875 L 43.65625 13.25 C 44.054688 12.863281 44.058594 12.226563 43.671875 11.828125 C 43.285156 11.429688 42.648438 11.425781 42.25 11.8125 L 9.96875 44.09375 L 5.90625 40.03125 L 38.1875 7.75 C 38.488281 7.460938 38.578125 7.011719 38.410156 6.628906 C 38.242188 6.246094 37.855469 6.007813 37.4375 6.03125 C 37.40625 6.03125 37.375 6.03125 37.34375 6.03125 Z"></path>
                            </svg>
                        </a>
                        <button type="button" @onclick="() => OpenConfirmPopup(kat)" class="btn btn-danger">
                            <svg class="icon-outline" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" viewBox="0 0 24 24">
                                <path d="M 10 2 L 9 3 L 3 3 L 3 5 L 4.109375 5 L 5.8925781 20.255859 L 5.8925781 20.263672 C 6.023602 21.250335 6.8803207 22 7.875 22 L 16.123047 22 C 17.117726 22 17.974445 21.250322 18.105469 20.263672 L 18.107422 20.255859 L 19.890625 5 L 21 5 L 21 3 L 15 3 L 14 2 L 10 2 z M 6.125 5 L 17.875 5 L 16.123047 20 L 7.875 20 L 6.125 5 z"></path>
                            </svg>
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<DeleteConfirmPopup Visible="ShowDeleteConfirmDialog"
                    ItemName="@_itemToDelete.Megnevezes"
                    OnCancel="CancelDeleteKategoria"
                    OnConfirm="() => ConfirmDeleteKategoria(_itemToDelete.Id)" />

@code {
    public List<SzobaKategoria>? Kategoriak;
    private bool ShowDeleteConfirmDialog = false;
    private SzobaKategoria _itemToDelete = new();

    protected override async Task OnInitializedAsync()
    {
        Kategoriak = await SzobaRepo.ReadKategoriaAllAsync();
    }

    private void OpenConfirmPopup(SzobaKategoria kategoria)
    {
        _itemToDelete = kategoria;
        ShowDeleteConfirmDialog = true;
    }

    private void CancelDeleteKategoria()
    {
        ShowDeleteConfirmDialog = false;
    }

    private async Task ConfirmDeleteKategoria(int id)
    {
        await SzobaRepo.DeleteKategoriaAsync(id);
        Kategoriak = await SzobaRepo.ReadKategoriaAllAsync();
        ShowDeleteConfirmDialog = false;
        StateHasChanged();
    }
}
